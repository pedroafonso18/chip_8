#include "../include/Chip8.h"
#include <fstream>

constexpr unsigned int START_ADDRESS = 0x200;
constexpr unsigned int FONTSET_SIZE = 80;
constexpr unsigned int FONTSET_START_ADDRESS = 0x50;

uint8_t fontset[FONTSET_SIZE] = 
{
  0xF0, 0x90, 0x90, 0x90, 0xF0,
  0x20, 0x60, 0x20, 0x20, 0x70, 
	0xF0, 0x10, 0xF0, 0x80, 0xF0, 
	0xF0, 0x10, 0xF0, 0x10, 0xF0, 
	0x90, 0x90, 0xF0, 0x10, 0x10, 
	0xF0, 0x80, 0xF0, 0x10, 0xF0, 
	0xF0, 0x80, 0xF0, 0x90, 0xF0, 
	0xF0, 0x10, 0x20, 0x40, 0x40, 
	0xF0, 0x90, 0xF0, 0x90, 0xF0, 
	0xF0, 0x90, 0xF0, 0x10, 0xF0, 
	0xF0, 0x90, 0xF0, 0x90, 0x90, 
	0xE0, 0x90, 0xE0, 0x90, 0xE0, 
	0xF0, 0x80, 0x80, 0x80, 0xF0, 
	0xE0, 0x90, 0x90, 0x90, 0xE0, 
	0xF0, 0x80, 0xF0, 0x80, 0xF0, 
	0xF0, 0x80, 0xF0, 0x80, 0x80
};

Chip8::Chip8()
{
  pc = START_ADDRESS;

  for (unsigned int i = 0; i < FONTSET_SIZE; ++i)
  {
    memory[FONTSET_START_ADDRESS * i] = fontset[i];
  }
}

void Chip8::LoadRom(
    char const* fileName
)
{
  std::ifstream file(fileName, std::ios::binary | std::ios::ate);

  if (file.is_open())
  {
    const std::streampos size = file.tellg();
    char* buffer = new char[size];

    file.seekg(0, std::ios::beg);
    file.read(buffer,size);
    file.close();

    for (long i = 0; i < size; ++i)
    {
      memory[START_ADDRESS + i] = buffer[i];
    }

    delete[] buffer;
  }
}
